---
title: "R√©aliser une appli avec `{shiny}` & `{bslib}`"
author: "Marie Vaugoyeau"
date: "2025/12/16"
date-format: "D MMMM YYYY"
format: 
  pdf:
    toc: true
    toc-title: Sommaire
    number-sections: true
execute: 
  eval: false
---
  
  
::: {.callout-note icon="false"}
[**Twitch du 16 d√©cembre 2025**](https://www.twitch.tv/videos/2645347872).\
:::
  
# S'initier √† la cr√©ation d'applications web

## C'est quoi une appli web ?

-   Une applications web est un objet informatique **manipulable directement, en ligne et sans installation**\
-   Une application peut aussi √™tre pr√©sente sur le r√©seau interne d'une entreprise, sur un unique ordinateur ou h√©berg√©e en ligne.

## Construire une application

-   Avoir une id√©e\
-   Documenter les besoins et attentes des utilisateur.trice.s\
-   Relier les besoins et attentes √† des actions\
-   Lister les donn√©es n√©cessaires puis faire **valider**\
-   R√©aliser une maquette simple et la **valider**\
-   Construire une maquette fid√®le et la **valider**\
-   Coder l'application\
-   Faire tourner en local\
-   D√©ployer l'application\
-   Faire √©voluer ou abandonner

## Shiny

[`{shiny}`](https://shiny.posit.co/) est un package `R` d√©velopp√© par [![](img/Posit-Logo.jpg){width="10%"}](https://posit.co/) en 2012.

![](img/shiny_logo.png){width="20%"}

## Explorer `Shiny`

-   Avant `Shiny`, il √©tait n√©cessaire d'avoir une bonne connaissance des technologies du web (`HTML`, `CSS`,...)\
-   `Shiny` permet de :
    -   g√©n√©rer simplement le front-end (l'interface utilisateur.trice) et le back-end sans apprendre de langage web\
    -   faire des tableaux de bords mais aussi des pages web pour communiquer les r√©sultats\
    -   de travailler directement sur les donn√©es de la personne utilisatrice\
    -   de g√©rer des cartes, des tableaux, des graphiques, des questionnaires...

## Exemples de r√©alisation

Beaucoup d'exemples sont disponibles dans la [galerie de Shiny](https://shiny.posit.co/r/gallery/)\
  

## Comprendre la structure d'une application

Toutes les applications ont :

-   une partie `User Interface` qui permet de g√©rer le `Front-End`, c'est-√†-dire √† quoi l'**application ressemble**\
-   une partie `Server` qui g√®re le `Back-End`, c'est-√†-dire les m√©canismes sous-jacents ou **que fait l'application**

::: callout-note
## A retenir

Dans une application `Shiny`, l'interface utilisateur.trice est g√©r√© par la fonction ou le fichier `ui` et les coulisses par la fonction ou le fichier `Server`.
:::

## Cr√©ation d'une structure de page avec `{bslib}`

Avec le package [`{bslib}`](https://rstudio.github.io/bslib/index.html), une page est construite √† partir d'une ou plusieurs sections appel√©es `card`

Les `card` peuvent-√™tre :

-   avec ou sans barre lat√©rale  
![](img/sidebarCard.png)\

```{r}
library(bslib)

ui <- page_fillable(

  card(
    card_header("Card without sidebar"),
    "No Sidebar"
  ),
  
  card(
    card_header("Card with sidebar"),
    layout_sidebar(
      sidebar = sidebar(
        bg = "lightgrey",
        "Sidebar"
      ),
      "Main Content"
    )
  )
  
)
```

-   s'encha√Æner sur la longueur de la page  
![](img/rows.png)\

```{r}
library(bslib)

ui <- page_fillable(

  card(card_header("Card 1")),
  card(card_header("Card 2")),
  card(card_header("Card 3"))
  
)
```

-   s'enchainer sur la largeur de la page   
![](img/columns.png)\

```{r}
library(bslib)

ui <- page_fillable(

  layout_columns(
     card(card_header("Card 1")),
     card(card_header("Card 2")),
     card(card_header("Card 3"))
  )
  
)
```

::: callout-tip
## Modifier la largeur et hauteur des `cards`

L'argument `col_widths` permet de param√©trer la largeur de chaque `card`.\
Si la somme d'une seule ligne est sup√©rieure √† 12, une nouvelle ligne est cr√©e par d√©faut.\
L‚Äôargument `row_heights` permet de fixer le rapport entre les lignes (une valeur fixe peut √©ventuellement √™tre utilis√©e).
:::

::::: columns
::: column
![](img/column-widths.png)

```{r}
library(bslib)

ui <- page_fillable(

  layout_columns(
    card(card_header("Card 1")),
    card(card_header("Card 2")),
    card(card_header("Card 3")),
    col_widths = c(4, 6, 2)
  )

)
```
:::

::: column
![](img/row-heights.png)

```{r}
library(bslib)

ui <- page_fillable(

  layout_columns(
    card(card_header("Card 1")),
    card(card_header("Card 2")),
    card(card_header("Card 3")),
    col_widths = c(6, 6, 8),
    row_heights = c(1, 2)
  )

)
```
:::
:::::

Il est aussi possible de mixer les `card` en lignes et colonnes\
![](img/mixed.png)

```{r}
library(bslib)  

ui <- page_fillable(

  layout_columns(
     card(card_header("Card 1")),
     layout_columns(
       card(card_header("Card 2")),
       card(card_header("Card 3")),
       col_widths = c(12, 12)
     )
  ),
     card(card_header("Card 4"))

)
```

::: callout-tip
## Pour aller plus loin

[Application layout guide](https://shiny.posit.co/r/articles/build/layout-guide/) sur le site de Shiny.
:::

# Application d√©velopp√©e lors du live

## Une appli sur les pingouins

Lors du live, j'ai d√©velopp√©e [cette application](https://mvaugoyeau.shinyapps.io/appli_penguins/), voici les diff√©rentes √©tapes üòä

## Initier la structure

Pour cr√©er une appli Shiny, un seul fichier `.R` suffit.

::: callout-tip
## squelette d'une appli

Pour g√©n√©rer facilement le squelette d'une appli, taper `shinyapp` puis taper sur `Entr√©e` pour utiliser le `snippet`.
:::

Afin de cr√©er l'application, je vais appeler le package `{bslib}` et `{tidyverse}` en plus du package `{shiny}`.

## Cr√©er la structure

La structure choisie est un page avec une barre de navigation contenant le titre et deux onglets. Le premier onglet a dans la fen√™tre une ligne avec deux colonnes et une deuxi√®me ligne sur la totalit√©.\
Le deuxi√®me onglet contient du texte.

```{r}
library(shiny)
library(bslib)
library(tidyverse)

ui <- page_navbar(
  title = "Les penguins",
  nav_panel(
    "Repr√©sentations",
    layout_columns(
      card(
        full_screen = TRUE,
        p("graphique sur la forme du bec")
      ),
      card(
        full_screen = TRUE,
        p("graphique sur la condition coporelle")
      )
    ),
    card(
      full_screen = TRUE,
      card_header("Donn√©es"),
      p("tableau des donn√©es")
    )
  ),
  nav_panel(
    "Information",
    p("Cette appli a √©t√© cr√©√©e dans le cadre de la formation R-Shiny"),
    p("Pour plus d'information contacter Marie (marie.vaugoyea@gmail.com)")
  )
)

server <- function(input, output, session) {
  
}

shinyApp(ui, server)
```

![](img/structure_bslib.png)

## Personnaliser l'interface

En ajoutant un th√®me gr√¢ce √† la fonction `bs_theme()` du package `{bslib}` : `theme = bs_theme(bootswatch = "morph")`.\
La ligne doit √™tre ajout√©e dans la fonction `page_navbar()`. Je mets g√©n√©ralement **en premier** mais ce n'est pas obligatoire.

En ajoutant des barres lat√©rales afin de donner la possibilit√© de choisir une esp√®ce pour le tableau et une √Æle pour le graphique sur la condition corporelle.\
Le fond des barres lat√©rales a √©t√© modifi√©s gr√¢ce √† l'argument `bg`.

```{r}
library(shiny)
library(bslib)
library(tidyverse)

ui <- page_navbar(
  theme = bs_theme(bootswatch = "morph"),
  title = "Les penguins",
  nav_panel(
    "Repr√©sentations",
    layout_columns(
      card(
        full_screen = TRUE,
        p("graphique sur la forme du bec")
      ),
      card(
        full_screen = TRUE,
        layout_sidebar(
          sidebar = sidebar(
            bg = "lightblue"
          ),
          p("graphique sur la condition coporelle")
        )
      )
    ),
    card(
      full_screen = TRUE,
      card_header("Donn√©es"),
      layout_sidebar(
        sidebar = sidebar(
          bg = "darkblue"
        ),
        p("tableau des donn√©es")
      )
    )
  ),
  nav_panel(
    "Information",
    p("Cette appli a √©t√© cr√©√©e dans le cadre de la formation R-Shiny"),
    p("Pour plus d'information contacter Marie (marie.vaugoyea@gmail.com)")
  )
)

server <- function(input, output, session) {
  
}

shinyApp(ui, server)
```

![](img/personalisation.png)

## Ajouter un √©l√©ment int√©ractif

Le premier graphique ajout√© est celui de la forme du bec. Il est rendu int√©ractif par l'utilisation du package [`{plotly}`](https://plotly.com/r/).

::: callout-important
## interactif = server au repos

L‚Äôinteractivit√© repose sur l‚Äôid√©e que l‚Äôutilisateur peut influencer le comportement de l‚Äôapplication sans relancer le code.
:::

```{r}
library(shiny)
library(bslib)
library(tidyverse)
library(plotly)

# creation vecteur_couleur
vecteur_quali <- 
  c(
    "Adelie" = "#DF9ED4FF",
    "Chinstrap" = "#C93F55FF",
    "Gentoo" = "#EACC62FF",
    "Biscoe" = "#469D76FF",
    "Dream" = "#3C4B99FF",
    "Torgersen" = "#924099FF"
  )

ui <- page_navbar(
  theme = bs_theme(bootswatch = "morph"),
  title = "Les penguins",
  nav_panel(
    "Repr√©sentations",
    layout_columns(
      card(
        full_screen = TRUE,
        plotlyOutput("bec")
      ),
      card(
        full_screen = TRUE,
        layout_sidebar(
          sidebar = sidebar(
            bg = "lightblue"
          ),
          p("graphique sur la condition coporelle")
        )
      )
    ),
    card(
      full_screen = TRUE,
      card_header("Donn√©es"),
      layout_sidebar(
        sidebar = sidebar(
          bg = "darkblue"
        ),
        p("tableau des donn√©es")
      )
    )
  ),
  nav_panel(
    "Information",
    p("Cette appli a √©t√© cr√©√©e dans le cadre de la formation R-Shiny"),
    p("Pour plus d'information contacter Marie (marie.vaugoyea@gmail.com)")
  )
)

server <- function(input, output, session) {
  output$bec <- renderPlotly(
    penguins |> 
      drop_na() |> 
      ggplot() +
      aes(
        x = bill_dep,
        y = bill_len,
        shape = sex,
        color = species,
        linetype = sex
      ) +
      geom_point() +
      geom_smooth(method = "lm", se = FALSE) + 
      scale_color_manual(values = vecteur_quali) +
      scale_shape_manual(values = c(17,6)) +
      labs(
        title = "Forme du bec",
        x = "largeur du bec (mm)",
        y = "longueur du bec (mm)",
        color = "esp√®ce",
        shape = "sexe",
        linetype = "sexe"
      ) +
      theme_minimal()
  )
}

shinyApp(ui, server)
```

![](img/graph_interactif.png)

Tu peux voir ici qu'un objet `bec` a √©t√© cr√©√© dans la partie `Server` gr√¢ce √† `renderPlotly()` du package `{plotly}` et appel√© dans la partie `ui` gr√¢ce √† la fonction `plotlyOutput()` du m√™me package.

## Param√©trer les choix de l'utilisateurice

Pour le graphique, la personne pourra choisir l'√Æle ou les √Æles √† repr√©senter et dans le tableau, le choix de(s) esp√®ce(s).\
Dans ce cas, il faut ajouter deux [widgets](https://shiny.posit.co/r/gallery/widgets/widget-gallery/) qui va permettre de rendre r√©actif l'appli shiny.

::: callout-important
## r√©activit√© = code tourne

La r√©activit√© repose sur l‚Äôid√©e que l‚Äôapplication r√©agit dynamiquement et sans d√©lai aux actions de l‚Äôutilisateur.trice.
:::

Chaque choix est enregistr√© dans un `input` qui a un nom unique puis utilis√© dans la partie `server`.

```{r}
library(shiny)
library(bslib)
library(tidyverse)
library(plotly)
library(DT)

# creation vecteur_couleur
vecteur_quali <- 
  c(
    "Adelie" = "#DF9ED4FF",
    "Chinstrap" = "#C93F55FF",
    "Gentoo" = "#EACC62FF",
    "Biscoe" = "#469D76FF",
    "Dream" = "#3C4B99FF",
    "Torgersen" = "#924099FF"
  )

ui <- page_navbar(
  theme = bs_theme(bootswatch = "morph"),
  title = "Les penguins",
  nav_panel(
    "Repr√©sentations",
    layout_columns(
      card(
        full_screen = TRUE,
        plotlyOutput("bec")
      ),
      card(
        full_screen = TRUE,
        layout_sidebar(
          sidebar = sidebar(
            bg = "lightblue",
            checkboxGroupInput(
              "ile",
              "Choississez une √Æle",
              selected = penguins$island |> fct_unique(),
              choiceNames = penguins$island |> fct_unique(),
              choiceValues = penguins$island |> fct_unique()
            )
          ),
          plotOutput("masse")
        )
      )
    ),
    card(
      full_screen = TRUE,
      card_header("Donn√©es"),
      layout_sidebar(
        sidebar = sidebar(
          bg = "darkblue",
          checkboxGroupInput(
            "espece",
            "Choississez une esp√®ce",
            selected = penguins$species |> fct_unique(),
            choiceNames = penguins$species |> fct_unique(),
            choiceValues = penguins$species |> fct_unique()
          )
        ),
        DTOutput("table")
      )
    )
  ),
  nav_panel(
    "Information",
    p("Cette appli a √©t√© cr√©√©e dans le cadre de la formation R-Shiny"),
    p("Pour plus d'information contacter Marie (marie.vaugoyea@gmail.com)")
  )
)

server <- function(input, output, session) {
  output$bec <- renderPlotly(
    penguins |> 
      drop_na() |> 
      ggplot() +
      aes(
        x = bill_dep,
        y = bill_len,
        shape = sex,
        color = species,
        linetype = sex
      ) +
      geom_point() +
      geom_smooth(method = "lm", se = FALSE) + 
      scale_color_manual(values = vecteur_quali) +
      scale_shape_manual(values = c(17,6)) +
      labs(
        title = "Forme du bec",
        x = "largeur du bec (mm)",
        y = "longueur du bec (mm)",
        color = "esp√®ce",
        shape = "sexe",
        linetype = "sexe"
      ) +
      theme_minimal()
  )
  
  output$masse <- renderPlot({
    penguins |> 
      filter(island %in% input$ile) |> 
      drop_na() |> 
      ggplot() +
      aes(
        x = body_mass,
        y = flipper_len,
        color = island
      ) +
      geom_point() +
      geom_smooth(method = "lm", se = FALSE) + 
      scale_color_manual(values = vecteur_quali) +
      labs(
        title = "Condition corporelle",
        x = "masse (g)",
        y = "longueur de la nageaoire (mm)",
        color = "√Æle"
      ) +
      facet_wrap(~ species) +
      theme_minimal()
  })
  
  data <- reactive({
    penguins |> filter(species %in% input$espece)
  })
  
  output$table <- renderDT(
    data(),
    class = "cell-border compact",
    extensions = c("Buttons"),
    filter = "top",
    options = 
      list(
        pageLength = 5, 
        dom = "Blftip",
        buttons = c(
          "copy", "csv", "excel", "pdf", "print"
        )
      ),
    editable = "cell",
    rownames = FALSE
  ) 
}

shinyApp(ui, server)
```

![](img/reactivite.png)

Comme pr√©c√©demment, les objets cr√©√©s dans la partie `server` gr√¢ce aux fonctions `render*()` du package `{shiny}` et `{DT}` sont appel√©s dans la partie `ui` gr√¢ce aux fonctions miroirs `*Output()` des m√™mes packages.

::: callout-tip
## `reactive()` de `{shiny}`

La fonction `reactive()` permet de cr√©er un objet qui va √™trer modifier √† chaque modification de l'`input` associ√©.
:::

## Communiquer avec l'utilisateurice

Il est important de communiquer avec la(les) personne(s) utilisant l'appli √† travers des messages pour la guider dans son utilisation.\
Par exemple, ici, le choix d'au moins une esp√®ce ou d'une √Æle est obligatoire.

Dans ce cas, on va bloquer la cr√©ation des sorties au fait de faire un choix gr√¢ce √† la fonction `req()` du package `{shiny}`.\
On va aussi envoyer un message en cas d'absence de choix gr√¢ce aux fonctions `textOutput()` et `renderText()` du package `{shiny}`.

```{r}
library(shiny)
library(bslib)
library(tidyverse)
library(plotly)
library(DT)

# creation vecteur_couleur
vecteur_quali <- 
  c(
    "Adelie" = "#DF9ED4FF",
    "Chinstrap" = "#C93F55FF",
    "Gentoo" = "#EACC62FF",
    "Biscoe" = "#469D76FF",
    "Dream" = "#3C4B99FF",
    "Torgersen" = "#924099FF"
  )

ui <- page_navbar(
  theme = bs_theme(bootswatch = "morph"),
  title = "Les penguins",
  nav_panel(
    "Repr√©sentations",
    layout_columns(
      card(
        full_screen = TRUE,
        plotlyOutput("bec")
      ),
      card(
        full_screen = TRUE,
        layout_sidebar(
          sidebar = sidebar(
            bg = "lightblue",
            checkboxGroupInput(
              "ile",
              "Choississez une √Æle",
              selected = penguins$island |> fct_unique(),
              choiceNames = penguins$island |> fct_unique(),
              choiceValues = penguins$island |> fct_unique()
            )
          ),
          plotOutput("masse"),
          textOutput("message_ile")
        )
      )
    ),
    card(
      full_screen = TRUE,
      card_header("Donn√©es"),
      layout_sidebar(
        sidebar = sidebar(
          bg = "darkblue",
          checkboxGroupInput(
            "espece",
            "Choississez une esp√®ce",
            selected = penguins$species |> fct_unique(),
            choiceNames = penguins$species |> fct_unique(),
            choiceValues = penguins$species |> fct_unique()
          )
        ),
        DTOutput("table"),
        textOutput("message_espece")
      )
    )
  ),
  nav_panel(
    "Information",
    p("Cette appli a √©t√© cr√©√©e dans le cadre de la formation R-Shiny"),
    p("Pour plus d'information contacter Marie (marie.vaugoyea@gmail.com)")
  )
)

server <- function(input, output, session) {
  output$bec <- renderPlotly(
    penguins |> 
      drop_na() |> 
      ggplot() +
      aes(
        x = bill_dep,
        y = bill_len,
        shape = sex,
        color = species,
        linetype = sex
      ) +
      geom_point() +
      geom_smooth(method = "lm", se = FALSE) + 
      scale_color_manual(values = vecteur_quali) +
      scale_shape_manual(values = c(17,6)) +
      labs(
        title = "Forme du bec",
        x = "largeur du bec (mm)",
        y = "longueur du bec (mm)",
        color = "esp√®ce",
        shape = "sexe",
        linetype = "sexe"
      ) +
      theme_minimal()
  )
  
  output$masse <- renderPlot({
    req(input$ile)
    penguins |> 
      filter(island %in% input$ile) |> 
      drop_na() |> 
      ggplot() +
      aes(
        x = body_mass,
        y = flipper_len,
        color = island
      ) +
      geom_point() +
      geom_smooth(method = "lm", se = FALSE) + 
      scale_color_manual(values = vecteur_quali) +
      labs(
        title = "Condition corporelle",
        x = "masse (g)",
        y = "longueur de la nageaoire (mm)",
        color = "√Æle"
      ) +
      facet_wrap(~ species) +
      theme_minimal()
  })
  
  data <- reactive({
    req(input$espece)
    penguins |> filter(species %in% input$espece)
  })
  
  output$message_ile <- renderText(
    if (is.null(input$ile)){validate("Une √Æle est n√©cessaire")}
  )
  
  output$message_espece <- renderText(
    if (is.null(input$espece)){validate("Une esp√®ce est n√©cessaire")}
  )
  
  output$table <- renderDT(
    data(),
    class = "cell-border compact",
    extensions = c("Buttons"),
    filter = "top",
    options = 
      list(
        pageLength = 5, 
        dom = "Blftip",
        buttons = c(
          "copy", "csv", "excel", "pdf", "print"
        )
      ),
    editable = "cell",
    rownames = FALSE
  ) 
}

shinyApp(ui, server)
```

![](img/message.png)

Et voil√†, n'h√©sites pas √† me faire des retours par [email](mailto:marie.vaugoyeau@gmail.com) ou sur [LinkedIn](https://www.linkedin.com/in/marie-vaugoyeau-72ab64153/) ‚úçÔ∏è

::: callout-note
Tu peux aussi t'inscrire √† la [newsletter](https://mvaugoyeau.kessel.media?source_type=social_network) pour √™tre au courant du prochain live üì∫
:::

Bonne journ√©e üòä
